{"title":"Merging data frames","markdown":{"headingText":"Merging data frames","headingAttr":{"id":"sec-merge","classes":[],"keyvalue":[]},"containsRefs":false,"markdown":"```{r setup, include=FALSE}\nknitr::opts_chunk$set(echo=TRUE, eval=TRUE, comment=NA)\nlibrary(webexercises)\nlibrary(PASWR2)\nlibrary(knitr)\nlibrary(kableExtra)\nlibrary(ggplot2)\nlibrary(tidyverse)\n```\n\n\n```{r read1, echo = FALSE}\nchol <- read.table(file = \"Data/chol.txt\", header = TRUE, fileEncoding = 'UTF-8-BOM')\nchol$gender <- factor(x = chol$gender, levels = c(\"female\", \"male\"))\nchol$smoke <- factor(x = chol$smoke, levels = c(\"no\", \"ex-smoker\", \"current\"))\nmeasurements <- read.csv(file = \"Data/measurements.csv\", fileEncoding = 'UTF-8-BOM')\nchol_full <- cbind(chol, measurements)\nchol_full$bmi <- chol_full$weight/(chol_full$height)^2\nsubject <- data.frame(id = \"P461\", ldl = 148, hdl = 78, trig = 120, age = 41, gender = \"male\", smoke = \"current\",\n                      weight = 84.05, height = 1.79)\nsubject$bmi <- subject$weight/(subject$height)^2\nchol_full <- rbind(chol_full, subject)\n```\n\n```{r read2, echo = FALSE}\neducation <- read.csv(file = \"Data/edu.csv\", na.strings = \"*\", fileEncoding = 'UTF-8-BOM')\neducation$year <- factor(x = education$year, levels = c(\"2016\", \"2017\", \"2018\", \"2019\", \"2020\", \"2021\", \"2022\"))\neducation$level <- factor(x = education$level, levels = c(\"ELC\", \"Primary\", \"Secondary\"))\neducation$ratio <- education$pupils/education$teachers\n```\n\n\nSometimes information relating to the same subjects or observations might be stored in two separate data frames. When this is the case it is easy to combine two data frames using the `merge()` function. `merge()` takes the following arguments:\n\n* `x =`: this is the first of the two data frames you want to merge together.\n* `y =`: this is the second of the two data frames you want to merge.\n* `by.x =`: this specifies which column in the first data frame should be used to merge. This is usually an identifying variable such as subjects' names or ID codes.\n* `by.y =`: this specifies which column in the second data frame should be used to merge.\n* `all =`: this takes values `TRUE` or `FALSE`, indicating whether all rows from both data frames should be included.\n* `all.x =`: this takes values `TRUE` and `FALSE`, indicating whether extra rows should be created in the second data frame so that all rows in the first data frame are kept.\n* `all.y =`: this takes values `TRUE` and `FALSE`, indicating whether extra rows should be created in the first data frame so that all rows in the second data frame are kept.\n\nOnly the arguments `x =` and `y =` are required. When any of of the `by. =` arguments are left out of the function, R will automatically look for columns which share the same name in the two data sets. When any of the `all. =` arguments are left out, they default to `FALSE`, so only complete cases are kept in the final merged data frame.\n\nThe file *treatment.csv* contains information on whether patients in a study testing a new treatment for high cholesterol were given the new drug or a placebo drug with no effect. Some of the patients in this new study are subjects from the `chol` data frame. We can read in the file *treatment.csv* and merge it with `chol_full` in order to see all the information available on a subject.\n\nTo start with, we need to read in *treatment.csv* and save this as a data frame called `treatment`.\n\n::: panel-tabset\n## R Code\n```{r data30, echo=FALSE}\ntreatment <- read.csv(file = \"Data/treatment.csv\", fileEncoding = 'UTF-8-BOM')\n```\n\n```{r data31, eval=FALSE}\ntreatment <- read.csv(file = \"treatment.csv\")\n```\n:::\n\nThen we can merge `chol_full` and `treatment` into a single data frame called `patients` using the following code.\n\n::: panel-tabset\n## R Code\n```{r data32.1, eval = FALSE}\npatients <- merge(x = chol_full, y = treatment, by.x = \"id\",\n                  by.y = \"patient_id\", all = TRUE)\nhead(patients[, -c(1:3)])\n```\n\n## Ouptut\n```{r data32.2, echo = FALSE}\npatients <- merge(x = chol_full, y = treatment, by.x = \"id\", by.y = \"patient_id\",\n                  all = TRUE)\nhead(patients[, -c(1:3)])\n```\n:::\n\nBecause the column showing the patient ID has a different name in `chol_full` and `treatment`, we have had to specify what it is called in each data frame here using `by.x =` and `by.y =` (make sure to check the contents of your data frames to notice things like this!). The argument `all = TRUE` means that we are keeping all information from both data frames, regardless of whether a patient only appears in `chol_full` or only in `treatment`. This is why in the excerpt of `patients` above, there are rows where the value for all variables except `treatment` are `NA`.\n\n:::{.question}\n::::{.question-header}\nTask\n::::\n::::{.question-container}\nThe file *class.csv* contains information on the average primary class size in the years 2016 - 2022. Read this file into R and save it as a data frame called `class`.\n\nMerge the information from the data frames `education` and `class` together into a new data frame called `primary`, showing all variables from `education` and the average class size for primary schools only. Look carefully at which row names these two data frames have in common.\n\n`r hide(\"Solution\")`\n```{r data-ans12.1, echo=FALSE}\nclass <- read.csv(file = \"Data/class.csv\", fileEncoding = 'UTF-8-BOM')\nprimary <- merge(x = education, y = class, by = c(\"year\", \"level\"), all.y = TRUE)\n```\n\nTo read the file *class.csv* in to R, we can use the following code.\n\n::: panel-tabset\n## R Code\n```{r data-ans12.2, eval=FALSE}\nclass <- read.csv(file = \"class.csv\")\n```\n:::\n\nIn order to merge the two data frames, we want to use the function `merge()`. The data frame we provide to the argument `x =` is `education` and the data frame for the `y =` argument is `class`. \n\nBecause we want to match up the rows with the same year and the same level of education, we need to give the argument `by =` a vector of these two variables. We can use the argument `by =`, rather than `by.x =` and `by.y =`, because the columns have the same names in both data frames.\n\nFinally, since we only want to show the rows for primary schools, we can specify `all.y =TRUE`. This will keep all the rows from the second data frame, `class`, and delete the rows from the first data frame which don't have a matching row in the second. For example, because there is no information on the average class size in secondary schools in 2016 in `class`, this row from `education` will not appear in `primary`.\n\n::: panel-tabset\n## R Code\n```{r data-ans12.3, eval = FALSE}\nprimary <- merge(x = education, y = class, by = c(\"year\", \"level\"), \n                 all.y = TRUE)\nprimary\n```\n\n## Ouptut\n```{r data-ans12.4, echo = FALSE}\nprimary\n```\n:::\n`r unhide()`\n::::\n:::\n\n---\n\nFor more information on merging data set, see [Section 1.11.4 Merging Data Frames](https://read.kortext.com/reader/pdf/92741/56){target=\"_blank\"} of *Probability and Statistics with R*.\n","srcMarkdownNoYaml":""},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["styles.css","include/webex.css"],"toc":true,"include-after-body":["include/webex.js"],"embed-resources":true,"output-file":"05-merge.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.4.553","editor":"source","theme":["cosmo","custom.scss"]},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}